#!/bin/sh
#
# Copyright (C) 2000-2016  Internet Systems Consortium, Inc. ("ISC")
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

#
# Common configuration data for system tests, to be sourced into
# other shell scripts.
#

# Find the top of the BIND9 tree.
TOP=${SYSTEMTESTTOP:=.}/../../..

# Make it absolute so that it continues to work after we cd.
TOP=`cd $TOP && pwd`

NAMED=$TOP/Build/Debug/named@EXEEXT@
# We must use "named -l" instead of "lwresd" because argv[0] is lost
# if the program is libtoolized.
LWRESD="$TOP/Build/Debug/named@EXEEXT@ -l"
DIG=$TOP/Build/Debug/dig@EXEEXT@
DELV=$TOP/Build/Debug/delv@EXEEXT@
RNDC=$TOP/Build/Debug/rndc@EXEEXT@
NSUPDATE=$TOP/Build/Debug/nsupdate@EXEEXT@
DDNSCONFGEN=$TOP/Build/Debug/ddns-confgen@EXEEXT@
TSIGKEYGEN=$TOP/Build/Debug/tsig-keygen@EXEEXT@
RNDCCONFGEN=$TOP/Build/Debug/rndc-confgen@EXEEXT@
KEYGEN=$TOP/Build/Debug/dnssec-keygen@EXEEXT@
KEYFRLAB=$TOP/Build/Debug/dnssec-keyfromlabel@EXEEXT@
SIGNER=$TOP/Build/Debug/dnssec-signzone@EXEEXT@
REVOKE=$TOP/Build/Debug/dnssec-revoke@EXEEXT@
SETTIME=$TOP/Build/Debug/dnssec-settime@EXEEXT@
DSFROMKEY=$TOP/Build/Debug/dnssec-dsfromkey@EXEEXT@
IMPORTKEY=$TOP/Build/Debug/dnssec-importkey@EXEEXT@
CHECKDS=$TOP/Build/Debug/dnssec-checkds@EXEEXT@
COVERAGE=$TOP/Build/Debug/dnssec-coverage@EXEEXT@
KEYMGR=$TOP/Build/Debug/dnssec-keymgr@EXEEXT@
CHECKZONE=$TOP/Build/Debug/named-checkzone@EXEEXT@
CHECKCONF=$TOP/Build/Debug/named-checkconf@EXEEXT@
PK11GEN="$TOP/Build/Debug/pkcs11-keygen@EXEEXT@ -q -s ${SLOT:-0} -p ${HSMPIN:-1234}"
PK11LIST="$TOP/Build/Debug/pkcs11-list@EXEEXT@ -s ${SLOT:-0} -p ${HSMPIN:-1234}"
PK11DEL="$TOP/Build/Debug/pkcs11-destroy@EXEEXT@ -s ${SLOT:-0} -p ${HSMPIN:-1234} -w 0"
JOURNALPRINT=$TOP/Build/Debug/named-journalprint@EXEEXT@
VERIFY=$TOP/Build/Debug/dnssec-verify@EXEEXT@
ARPANAME=$TOP/Build/Debug/arpaname@EXEEXT@
RESOLVE=$TOP/lib/samples/resolve
RRCHECKER=$TOP/Build/Debug/named-rrchecker@EXEEXT@
GENRANDOM=$TOP/Build/Debug/genrandom@EXEEXT@
NSLOOKUP=$TOP/Build/Debug/nslookup@EXEEXT@
DNSTAPREAD=$TOP/Build/Debug/dnstap-read@EXEEXT@
MDIG=$TOP/Build/Debug/mdig@EXEEXT@
NZD2NZF=$TOP/Build/Debug/named-nzd2nzf@EXEEXT@
FSTRM_CAPTURE=@FSTRM_CAPTURE@

# this is given as argument to native WIN32 executables
RANDFILE=`cygpath -w $TOP/bin/tests/system/random.data`

BIGKEY=$TOP/Build/Debug/bigkey@EXEEXT@
DLOPEN=$TOP/Build/Debug/dlopen@EXEEXT@
GENCHECK=$TOP/Build/Debug/gencheck@EXEEXT@
KEYCREATE=$TOP/Build/Debug/keycreate@EXEEXT@
KEYDELETE=$TOP/Build/Debug/keydelete@EXEEXT@
LWTEST=$TOP/Build/Debug/lwtest@EXEEXT@
MAKEJOURNAL=$TOP/Build/Debug/makejournal@EXEEXT@

# The "stress" test is not run by default since it creates enough
# load on the machine to make it unusable to other users.
# v6synth
SUBDIRS="acl additional addzone allow_query autosign builtin cacheclean case
	 catz checkconf @CHECKDS@ checknames checkzone cookie @COVERAGE@
	 database digdelv dlv dlvauto dlz dlzexternal dname dns64 dnssec
	 @DNSTAP@ dscp dsdigest dyndb ecdsa ednscompliance emptyzones
	 fetchlimit filter-aaaa formerr forward geoip glue gost inline ixfr
	 @KEYMGR@ legacy limits logfileconfig lwresd masterfile masterformat
	 metadata mkeys names notify nslookup nsupdate nzd2nzf pending
	 pipelined @PKCS11_TEST@ reclimit redirect resolver rndc rpz
	 rpzrecurse rrchecker rrl rrsetorder rsabigexponent runtime sfcache
	 smartsign sortlist spf staticstub statistics statschannel stub tcp
	 tkey tsig tsiggss unknown upforwd verify views wildcard xfer
	 xferquota zero zonechecks"

#Things that are different on Windows
KILL="/bin/kill -f"
DIFF="diff --strip-trailing-cr"
DOS2UNIX=dos2unix
# No trailing period
TP=

# Configure is launched from native environment, but tests are run in Cygwin -
# so any detection is unreliable. 
SHELL="/bin/bash -o igncr"
CURL=@CURL@
XMLLINT=@XMLLINT@
PERL=/usr/bin/perl

if test -n "$PERL"
then
	if $PERL -e "use IO::Socket::INET6;" 2> /dev/null
	then
		TESTSOCK6="$PERL $TOP/bin/tests/system/testsock6.pl"
	else
		TESTSOCK6=false
	fi
else
	TESTSOCK6=false
fi

if grep "^#define WANT_IPV6 1" $TOP/config.h > /dev/null 2>&1 ; then
        TESTSOCK6="$TESTSOCK6"
else
        TESTSOCK6=false
fi


PYTHON=@PYTHON@

#
# Determine if we support various optional features.
#
CHECK_DSA=@CHECK_DSA@
XMLSTATS=@XMLSTATS@
JSONSTATS=@JSONSTATS@
ZLIB=@ZLIB@
NZD=@NZD_TOOLS@

. ${TOP}/version

export NAMED LWRESD DIG NSUPDATE KEYGEN KEYFRLAB SIGNER KEYSIGNER KEYSETTOOL \
       PERL SUBDIRS RNDC CHECKZONE PK11GEN PK11LIST PK11DEL TESTSOCK6 \
       JOURNALPRINT ARPANAME RESOLVE RRCHECKER NSLOOKUP DESCRIPTION PYTHON \
       MDIG FSTRM_CAPTURE NZD2NZF \
       RANDFILE BIGKEY DLOPEN GENCHECK KEYCREATE KEYDELETE LWTEST \
       MAKEJOURNAL
